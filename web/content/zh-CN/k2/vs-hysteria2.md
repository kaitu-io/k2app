---
title: "k2 vs Hysteria2：拥塞控制机制对比"
date: 2026-02-21
summary: "深入对比 k2 自研自适应拥塞控制算法与 Hysteria2 Brutal 固定发送速率机制的差异，从丢包恢复、延迟稳定性、带宽利用率与共存公平性四个维度展开分析。"
section: comparison
order: 7
draft: false
---

# k2 vs Hysteria2：拥塞控制机制对比

拥塞控制算法是隧道协议性能的核心决定因素之一。在高丢包率、高延迟的网络环境下，不同的拥塞控制策略会带来截然不同的用户体验。本文从四个维度对比 k2 与 Hysteria2 的拥塞控制机制。

## 背景

**k2** 采用自研自适应拥塞控制算法，以速率为基础，通过对效用函数进行梯度上升来寻找最优发送速率，能够动态响应网络条件变化。

**Hysteria2** 采用名为 Brutal 的拥塞控制策略：由用户手动指定最大带宽上限，协议以该速率持续发送，不响应拥塞信号。

---

## 维度一：丢包恢复

### k2

k2 的自研自适应拥塞控制算法维护一个自适应丢包惩罚系数。当检测到丢包时，算法会区分"拥塞性丢包"与"非拥塞性丢包"（如审查设备主动丢弃）：

- **自适应惩罚系数**：根据观测到的丢包模式动态调整，避免将审查引发的丢包误判为网络拥塞。
- **激进模式**：针对高审查网络环境启用，允许在一定非拥塞丢包率下维持较高发送速率。
- **探测机制**：在速率下调后，定期向更高速率发起探测，主动恢复可用带宽。

### Hysteria2

Hysteria2 Brutal 策略忽略所有丢包信号，以固定速率持续发送。这意味着：

- 无法区分拥塞性丢包与其他类型丢包。
- 不进行速率回退，依赖重传机制处理丢包。
- 在高丢包网络中可能导致重传风暴，进一步恶化网络状况。

**结论**：k2 的自适应丢包处理在高审查、高丢包环境中表现更稳健。

---

## 维度二：延迟稳定性

### k2

k2 自研算法的效用函数将 RTT（往返时延）作为重要输入变量之一。当缓冲区开始积压（bufferbloat）时，RTT 上升会触发速率下调，从而抑制延迟恶化：

- **RTT 感知**：实时监测往返时延，防止过度填充网络缓冲区。
- **基于速率的发包节奏（pacing）**：均匀分布数据包发送时间，避免突发流量造成队列堆积。

### Hysteria2

Hysteria2 的固定速率发送策略对 RTT 变化不敏感：

- 以恒定速率填充链路，容易导致路由器缓冲区堆积（bufferbloat）。
- 在共享链路上，延迟可能随其他流量的增减而大幅波动。

**结论**：k2 的 RTT 感知机制在延迟稳定性上优于 Hysteria2 的固定速率策略。

---

## 维度三：带宽利用率

### k2

k2 自研算法通过梯度上升机制持续探测最优发送速率：

- **无需手动配置**：算法自动发现并跟踪网络实际可用带宽。
- **探测机制**：在速率下调后周期性地尝试更高速率，动态恢复可用吞吐量。
- **适应动态网络**：在带宽频繁变化的移动网络或共享链路上表现更佳。

### Hysteria2

Hysteria2 要求用户手动指定目标带宽：

- **依赖用户设定**：若设定值低于实际可用带宽，链路利用率不足；若设定值过高，则持续造成拥塞。
- **无自动探测**：不具备动态跟踪带宽变化的能力。
- **适用场景有限**：仅在用户能够准确知晓线路容量时效果最佳。

**结论**：k2 的自动带宽探测机制降低了配置门槛，并在动态网络环境中保持更高的有效利用率。

---

## 维度四：共存公平性

### k2

k2 的速率基础 pacing 机制在与其他流量共存时表现出较好的公平性：

- **与 TCP 流量共存**：速率自适应调整，不主动挤占其他连接的带宽。
- **多流场景稳定**：在同一链路上存在多个隧道连接时，各流量能相对均衡地分配带宽。

### Hysteria2

Hysteria2 的 Brutal 策略在共存场景下存在明显问题：

- **挤占其他流量**：以固定速率持续发送，不主动为其他流量让路，可能导致 TCP 连接饥饿。
- **拥塞崩溃风险**：在多流并发时，可能引发拥塞崩溃（congestion collapse），整体吞吐量大幅下降。

**结论**：k2 的速率自适应策略在多流共存场景下更具公平性，不会主动破坏其他连接的正常运行。

---

## 对比总结

| 对比维度 | k2（自研自适应算法） | Hysteria2（Brutal） |
|---------|-------------------|-------------------|
| 丢包恢复 | 自适应惩罚系数，区分拥塞性与非拥塞性丢包 | 忽略丢包信号，依赖重传 |
| 延迟稳定性 | RTT 感知 + 速率 pacing，抑制 bufferbloat | 固定速率，易造成队列堆积 |
| 带宽利用率 | 自动探测最优速率，无需手动配置 | 需手动设定，无动态探测 |
| 共存公平性 | 速率自适应，与其他流量和平共存 | 固定速率，易挤占其他流量 |

---

## 说明与展望

上述对比基于算法设计层面的分析。基准测试数据将在条件成熟时单独发布。

k2 自研自适应拥塞控制算法的完整技术细节将在**开源日公开**。
